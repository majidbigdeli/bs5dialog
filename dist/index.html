<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>bs5dialog demo - Offcanvas ShowOffcanvasDialog Test</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous" />

  <script src="https://cdn.bootcdn.net/ajax/libs/axios/1.3.4/axios.js"></script>

  <link rel="stylesheet" href="./bs5dialog.css" />
  <script src="./bs5dialog.js"></script>

  <style>
    .demo .btn {
      border: 1px solid #999;
    }
  </style>
</head>

<body>
  <div class="container demo">
    <div class="row">
      <div class="mb-3">
        <div class="col-xs-12">
          <div class="card">
            <div class="card-header">Alert</div>
            <div class="card-body">
              <button class="btn btn-primary btn-alert btn-sm" data-type="primary">primary</button>
              <button class="btn btn-secondary btn-alert btn-sm" data-type="secondary">secondary</button>
              <button class="btn btn-success btn-alert btn-sm" data-type="success">success</button>
              <button class="btn btn-danger btn-alert btn-sm" data-type="danger">danger</button>
              <button class="btn btn-warning btn-alert btn-sm" data-type="warning">warning</button>
              <button class="btn btn-info btn-alert btn-sm" data-type="info">info</button>
              <button class="btn btn-light btn-alert btn-sm" data-type="light">light</button>
              <button class="btn btn-dark btn-alert btn-sm" data-type="dark">dark</button>
              <button class="btn btn-link btn-alert btn-sm" data-type="link" data-timeout="30000">link</button>
            </div>
            <div class="card-footer"></div>
          </div>
        </div>
      </div>

      <div class="mb-3">
        <div col-xs-12>
          <div class="card">
            <div class="card-header">Confirm</div>
            <div class="card-body">
              <button class="btn btn-primary btn-confirm btn-sm" data-type="primary">primary</button>
              <button class="btn btn-secondary btn-confirm btn-sm" data-type="secondary">secondary</button>
              <button class="btn btn-success btn-confirm btn-sm" data-type="success">success</button>
              <button class="btn btn-danger btn-confirm btn-sm" data-type="danger">danger</button>
              <button class="btn btn-warning btn-confirm btn-sm" data-type="warning">warning</button>
              <button class="btn btn-info btn-confirm btn-sm" data-type="info">info</button>
              <button class="btn btn-light btn-confirm btn-sm" data-type="light">light</button>
              <button class="btn btn-dark btn-confirm btn-sm" data-type="dark">dark</button>
              <button class="btn btn-link btn-confirm btn-sm" data-type="link">link</button>
            </div>
            <div class="card-footer"></div>
          </div>
        </div>
      </div>

      <div class="mb-3">
        <div col-xs-12>
          <div class="card">
            <div class="card-header">Prompt</div>
            <div class="card-body">
              <button class="btn btn-primary btn-prompt btn-sm" data-type="primary">primary</button>
              <button class="btn btn-secondary btn-prompt btn-sm" data-type="secondary">secondary</button>
              <button class="btn btn-success btn-prompt btn-sm" data-type="success">success</button>
              <button class="btn btn-danger btn-prompt btn-sm" data-type="danger">danger</button>
              <button class="btn btn-warning btn-prompt btn-sm" data-type="warning">warning</button>
              <button class="btn btn-info btn-prompt btn-sm" data-type="info">info</button>
              <button class="btn btn-light btn-prompt btn-sm" data-type="light">light</button>
              <button class="btn btn-dark btn-prompt btn-sm" data-type="dark">dark</button>
              <button class="btn btn-link btn-prompt btn-sm" data-type="link">link</button>
            </div>
            <div class="card-footer"></div>
          </div>
        </div>
      </div>

      <div class="mb-3">
        <div class="card">
          <div class="card-header">Spinner</div>
          <div class="card-body">
            <div class="row">
              <div class="col-sm-6">
                <form class="" id="loading-form">
                  <div class="mb-3 row">
                    <label class="col-3 col-form-label required">loading type</label>
                    <div class="col">
                      <select class="form-control" name="type" id="loading-type">
                        <option value="primary">primary</option>
                        <option value="secondary">secondary</option>
                        <option value="success">success</option>
                        <option value="danger">danger</option>
                        <option value="warning">warning</option>
                        <option value="info">info</option>
                        <option value="light">light</option>
                        <option value="dark">dark</option>
                        <option value="link">link</option>
                      </select>
                    </div>
                  </div>

                  <div class="mb-3 row">
                    <label class="col-3 col-form-label">animation</label>
                    <div class="col">
                      <select class="form-control" name="animation" id="loading-animation">
                        <option value="border">border</option>
                        <option value="grow">grow</option>
                      </select>
                    </div>
                  </div>

                  <div class="mb-3 row">
                    <label class="col-3 col-form-label">timeout</label>
                    <div class="col">
                      <input type="number" class="form-control" value="2000" id="loading-timeout" />
                      <small class="form-hint"></small>
                    </div>
                  </div>

                  <div class="row">
                    <label class="col-3 col-form-label pt-0">backdrop</label>
                    <div class="col">
                      <label class="form-check">
                        <input class="form-check-input" type="checkbox" checked="" id="loading-backdrop" />
                        <span class="form-check-label">backdrop</span>
                      </label>
                    </div>
                  </div>

                  <div class="row">
                    <div class="col-3 my-2 ms-auto">
                      <button type="button" class="btn btn-sm btn-primary btn-show-loading">Show Spinner</button>
                    </div>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="mb-3">
        <div col-xs-12>
          <div class="card">
            <div class="card-header">Toast</div>
            <div class="card-body">
              <button class="btn btn-show-toast btn-sm mb-1" data-type="primary" data-position="center">center</button>
              <button class="btn btn-show-toast btn-sm mb-1" data-type="secondary" data-position="top">top</button>
              <button class="btn btn-show-toast btn-sm mb-1" data-type="success" data-position="bottom">bottom</button>
              <button class="btn btn-show-toast btn-sm mb-1" data-type="danger" data-position="left">left</button>
              <button class="btn btn-show-toast btn-sm mb-1" data-type="warning" data-position="right">right</button>
              <button class="btn btn-show-toast btn-sm mb-1" data-type="info" data-position="top-left">top-left</button>
              <button class="btn btn-show-toast btn-sm mb-1" data-type="light"
                data-position="top-right">top-right</button>
              <button class="btn btn-show-toast btn-sm mb-1" data-type="dark"
                data-position="bottom-left">bottom-left</button>
              <button class="btn btn-show-toast btn-sm mb-1" data-type="link"
                data-position="bottom-right">bottom-right</button>
            </div>
            <div class="card-footer"></div>
          </div>
        </div>
      </div>

      <div class="mb-3">
        <div col-xs-12>
          <div class="card">
            <div class="card-header">Message</div>
            <div class="card-body">
              <button class="btn btn-show-message btn-sm mb-1">default</button>
              <button class="btn btn-show-message btn-sm mb-1" data-type="primary"
                data-position="center">center</button>
              <button class="btn btn-show-message btn-sm mb-1" data-type="secondary" data-position="top">top</button>
              <button class="btn btn-show-message btn-sm mb-1" data-type="success"
                data-position="bottom">bottom</button>
              <button class="btn btn-show-message btn-sm mb-1" data-type="danger" data-position="left">left</button>
              <button class="btn btn-show-message btn-sm mb-1" data-type="warning" data-position="right">right</button>
              <button class="btn btn-show-message btn-sm mb-1" data-type="info"
                data-position="top-left">top-left</button>
              <button class="btn btn-show-message btn-sm mb-1" data-type="light"
                data-position="top-right">top-right</button>
              <button class="btn btn-show-message btn-sm mb-1" data-type="dark"
                data-position="bottom-left">bottom-left</button>
              <button class="btn btn-show-message btn-sm mb-1" data-type="link"
                data-position="bottom-right">bottom-right</button>
            </div>
            <div class="card-footer"></div>
          </div>
        </div>
      </div>

      <!-- Offcanvas card -->
      <div class="mb-3">
        <div col-xs-12>
          <div class="card">
            <div class="card-header">Offcanvas</div>

            <div class="card-body">
              <button class="btn btn-offcanvas btn-sm mb-1" data-direction="start" data-scroll="true">start
                offcanvas</button>
              <button class="btn btn-offcanvas btn-sm mb-1" data-direction="end" data-scroll="true">end
                offcanvas</button>
              <button class="btn btn-offcanvas btn-sm mb-1" data-direction="top" data-scroll="true">top
                offcanvas</button>
              <button class="btn btn-offcanvas btn-sm mb-1" data-direction="bottom" data-scroll="true">bottom
                offcanvas</button>
              <button class="btn btn-offcanvas btn-sm mb-1" data-direction="start" data-backdrop="false"
                data-scroll="true">
                offcanvas without backdrop
              </button>
              <button class="btn btn-offcanvas btn-sm mb-1" data-direction="start" data-scroll="false">offcanvas without
                scroll</button>
              <button class="btn btn-offcanvas btn-sm mb-1" data-direction="start" data-dark="true">offcanvas
                dark</button>
              <button class="btn btn-offcanvas btn-sm mb-1" data-direction="start" data-id="example-offcanvas">
                offcanvas static id
              </button>
              <button class="btn btn-offcanvas btn-sm mb-1" data-direction="start" data-size="300px"
                data-content="<button class='btn btn-sm btn-lg btn-success'>Click Me</button>">
                offcanvas size 300px
              </button>

              <!-- ✅ Test button -->
              <button class="btn btn-sm btn-success mb-1" id="btn-test-offcanvas-dialog">
                Test ShowOffcanvasDialog (FULL)
              </button>
            </div>

            <div class="card-footer"></div>
          </div>
        </div>
      </div>

      <div class="mb-3">
        <div col-xs-12>
          <div class="card">
            <div class="card-header">Load page or content</div>
            <div class="card-body">
              <button class="btn btn-sm btn-open-content" data-content="./form.html">load form</button>
              <button class="btn btn-sm btn-open-content" data-content="./form1.html">load when 404</button>
              <button class="btn btn-sm btn-open-content" data-fullscreen="true"
                data-content="https://ymlluo.github.io/bs5dialog/">
                open fullscreen page
              </button>
              <button class="btn btn-sm btn-open-content" data-backdrop="false" data-title="lily's story"
                data-content="<p>Once upon a time... (long content)</p>">
                load long content
              </button>
            </div>
            <div class="card-footer"></div>
          </div>
        </div>
      </div>

      <div class="mb-3">
        <div col-xs-12>
          <div class="card">
            <div class="card-header">use bs5dialog.startup()</div>
            <div class="card-body">
              <button class="btn btn-sm mb-2" data-bs5-dialog="alert"
                title="show alert">data-bs5-dialog="alert"</button>
              <button class="btn btn-sm mb-2" data-bs5-dialog="confirm"
                title="show confirm">data-bs5-dialog="confirm"</button>
              <button class="btn btn-sm mb-2" data-bs5-dialog="prompt"
                title="show prompt">data-bs5-dialog="prompt"</button>
              <button class="btn btn-sm mb-2" data-bs5-dialog="message"
                title="show message">data-bs5-dialog="message"</button>
              <button class="btn btn-sm mb-2" data-bs5-dialog="toast"
                title="show toast">data-bs5-dialog="toast"</button>
              <button class="btn btn-sm mb-2" data-bs5-dialog="load"
                data-content="show load content">data-bs5-dialog="load"</button>
              <button class="btn btn-sm mb-2" data-bs5-dialog="offcanvas" data-bs5-dialog-option-title="offcanvas"
                data-content="show load offcanvas">
                data-bs5-dialog="offcanvas"
              </button>
            </div>
            <div class="card-footer"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    bs5dialog.startup();

    // -------------------------
    // Minimal loader for demo
    // -------------------------
    function showLoader() {
      console.log("loader: show");
    }
    function hideLoader() {
      console.log("loader: hide");
    }

    // -------------------------
    // ShowOffcanvasDialog (FULL TEST)
    // -------------------------
    function ShowOffcanvasDialog(url, width, height, title, canBeFullScreen) {
      try {
        if (window.parent) {
          var tourElement = window.parent.document.getElementById("start-iframe-tour");
          if (tourElement) tourElement.style.display = "none";
        }
      } catch (error) {
        console.error("An error occurred in ShowOffcanvasDialog:", error.message);
      }

      var canBeFullscreen = canBeFullScreen !== false;
      var modalHeight = height || 580;

      // setDefaultRetValue hack (اگر وجود داشت)
      try {
        if (window.setDefaultRetValue) window.setDefaultRetValue("");
      } catch (e) { }
      window.defaultRetValue = "";

      // DialogView=True
      if (url.indexOf("?") < 0) url = url + "?DialogView=True";
      else if (url.toLowerCase().indexOf("dialogview=") < 0) url = url + "&DialogView=True";

      showLoader();

      // نکته: برای اینکه تست 100% کار کنه، بهتره آدرس same-origin مثل ./form.html باشه
      return bs5dialog
        .offcanvas(url, {
          title: title || " ",
          type: "primary",
          direction: "end",
          // اینجا px می‌دیم تا حتماً اندازه قابل پیش‌بینی باشد
          size: (width || 520) + "px",
          backdrop: true,
          scroll: true,
          dark: false,
          maximize: false,

          onShown: function (dialogRef) {
            hideLoader();

            const iframe = dialogRef.querySelector("iframe");
            if (!iframe) return;

            const header = dialogRef.querySelector(".offcanvas-header");
            const footer = dialogRef.querySelector(".offcanvas-footer");
            const body = dialogRef.querySelector(".offcanvas-body");

            const headerH = header ? header.getBoundingClientRect().height : 0;
            const footerH = footer ? footer.getBoundingClientRect().height : 0;

            // padding واقعی body (bootstrap)
            const bodyStyle = body ? getComputedStyle(body) : null;
            const padTop = bodyStyle ? parseFloat(bodyStyle.paddingTop) : 0;
            const padBottom = bodyStyle ? parseFloat(bodyStyle.paddingBottom) : 0;

            const setIframeHeightToOffcanvas = () => {
              const offH = dialogRef.getBoundingClientRect().height;
              const available = Math.max(0, offH - headerH - footerH - padTop - padBottom);
              iframe.style.height = available + "px";
            };

            // ✅ همیشه هم‌قد offcanvas
            setIframeHeightToOffcanvas();

            // اگر fullscreen/maximize شد هم دوباره تنظیم کن
            const btnMax = dialogRef.querySelector(".btn-maximize");
            const btnMin = dialogRef.querySelector(".btn-minimize");
            btnMax?.addEventListener("click", setIframeHeightToOffcanvas);
            btnMin?.addEventListener("click", setIframeHeightToOffcanvas);

            // اگر سایز به هر دلیل تغییر کرد (resize viewport)، دوباره تنظیم کن
            window.addEventListener("resize", setIframeHeightToOffcanvas);
          },

          onHidden: function () {
            // RetVal logic demo-safe
            if (typeof RequestRetVal == "function") {
              RequestRetVal(window.defaultRetValue);
            } else if (typeof AjaxRequest == "function") {
              AjaxRequest(window.defaultRetValue);
            } else {
              console.log("onHidden defaultRetValue:", window.defaultRetValue);
            }
          }
        })
        .then(r => {
          window.RadBootstrapDialog = r.modalInstance;
          // اگر overrideModal دارید و offcanvas-compatible نیست، این خط را کامنت کنید
          if (typeof overrideModal === "function") overrideModal(r);
          return r;
        });
    }

    // -------------------------
    // Existing demo bindings
    // -------------------------
    document.querySelectorAll(".btn-alert").forEach(function (item) {
      item.onclick = function () {
        var type = item.getAttribute("data-type");
        bs5dialog.alert("Your payment of $100 has been successfully submitted.", {
          type: type,
          title: "Payment succedeed",
          backdrop: false
        });
      };
    });

    document.querySelectorAll(".btn-confirm").forEach(function (item) {
      item.onclick = function () {
        var type = item.getAttribute("data-type");
        bs5dialog.confirm("Do you really want to remove these files?<br> What you've done cannot be undone.?", {
          title: "Are you sure?",
          type: type,
          onConfirm: () => {
            bs5dialog.alert("remove 100 files", { type: type, timeout: 2000 });
          }
        });
      };
    });

    document.querySelectorAll(".btn-prompt").forEach(function (item) {
      item.onclick = function () {
        var type = item.getAttribute("data-type");
        bs5dialog.prompt("Please enter your PIN:", {
          type: type,
          onConfirm: val => {
            bs5dialog.alert("Your PIN:" + val, { type: type });
          }
        });
      };
    });

    document.querySelector(".btn-show-loading").addEventListener("click", function () {
      var type = document.getElementById("loading-type").value;
      var animation = document.getElementById("loading-animation").value;
      var timeout = document.getElementById("loading-timeout").value;
      var backdrop = document.getElementById("loading-backdrop").checked;
      bs5dialog.loading("#loading-form", { type: type, animation: animation, timeout: timeout, backdrop: backdrop });
    });

    document.querySelectorAll(".btn-show-toast").forEach(function (item) {
      item.onclick = function () {
        var position = item.getAttribute("data-position");
        var type = item.getAttribute("data-type");
        let toast = bs5dialog.toast("Your post has been archived!", {
          title: "New Message",
          subtitle: Date(),
          type: type,
          position: position,
          timeout: 300000
        });
        toast.el.addEventListener("click", function () {
          toast.el.hide();
        });
      };
    });

    document.querySelectorAll(".btn-show-message").forEach(function (item) {
      item.onclick = function () {
        var position = item.getAttribute("data-position");
        var type = item.getAttribute("data-type");
        bs5dialog.message("Your post has been archived!", position ? { type: type, position: position, timeout: 1000 } : {});
      };
    });

    document.querySelectorAll(".btn-open-content").forEach(function (item) {
      item.onclick = function (e) {
        e.preventDefault();
        var content = item.getAttribute("data-content");
        var title = item.getAttribute("data-title") || "";
        var backdrop = item.getAttribute("data-backdrop") || "";
        var fullscreen = item.getAttribute("data-fullscreen") || false;

        bs5dialog
          .load(content, {
            title: title,
            backdrop: backdrop,
            maximize: fullscreen,
            onSubmitDone(submitResult) {
              console.log(submitResult);
            }
          })
          .then(loadPage => {
            loadPage.el.addEventListener("bs5:dialog:form:submit:complete", function (e) { });
          });
      };
    });

    document.querySelectorAll(".btn-offcanvas").forEach(function (item) {
      item.onclick = function (e) {
        e.preventDefault();
        var content = item.getAttribute("data-content");
        var direction = item.getAttribute("data-direction") || "";
        var dark = item.getAttribute("data-dark") || "";
        var id = item.getAttribute("data-id") || "";
        var backdrop = item.getAttribute("data-backdrop") || "true";
        var scroll = item.getAttribute("data-scroll") || "";
        var size = item.getAttribute("data-size") || "";

        bs5dialog.offcanvas(
          content || "Some text as placeholder. In real life you can have the elements you have chosen. Like, text, images, lists, etc.",
          {
            title: "shopping cart",
            size: size,
            id: id,
            direction: direction,
            backdrop: backdrop,
            scroll: scroll,
            dark: dark,
            container: ".container"
          }
        );
      };
    });

    // ✅ Test binding
    document.getElementById("btn-test-offcanvas-dialog").addEventListener("click", function () {
      ShowOffcanvasDialog("https://192.168.11.18/voip/swagger/index.html", 1520, 280, "Full Offcanvas Dialog Test", true);
    });
  </script>
</body>

</html>